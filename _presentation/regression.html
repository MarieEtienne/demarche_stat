<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Régression linéaire</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marie-Pierre Etienne" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link rel="stylesheet" href="mpe_pres.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Régression linéaire
## simple et multiple
### Marie-Pierre Etienne
### <a href="mailto:marie-pierre.etienne@agrocampus-ouest.fr" class="email">marie-pierre.etienne@agrocampus-ouest.fr</a>
### 2021/11/19 (updated: 2022-09-14)

---

name: intro

&lt;!-- F1D763 --&gt;
&lt;!-- F7A913 --&gt;
&lt;!-- C94326 --&gt;
&lt;!-- 1F908E --&gt;
&lt;!-- 33658A --&gt;







# Introduction

--
## Etude de la pollution au SO2

On a mesuré pour 41 villes américaines, la pollution au SO2 ainsi que la population dans la ville




```r
library(coursesdata) #remotes::install_github('MarieEtienne/coursesdata')
data(usdata)
```


&lt;img src="regression_files/figure-html/visu_reg_simple-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;



--
&lt;p class="question"&gt; La taille d'une ville est elle liée à la pollution en SO2 ?&lt;/p&gt;


---
template: intro
## Cadre général du modèle de régression simple

On étudie le lien entre  
- une variable quantitative notée `\(Y\)` (l'indicateur de SO2),
- et une variable quantitative `\(x\)` (la taille de la population)

Les données peuvent être visualisées à l'aide d'un nuage de points.

--
&lt;img src="regression_files/figure-html/visu_reg_simple-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

--
&lt;p class="question"&gt; La variable x permet-elle d'expliquer la variabilité de la variable Y ?&lt;/p&gt;

---
name: model
# Rappel : la régression simple

--


##  Une visualisation graphique du modèle d'analyse de régression simple

 .center[Si la population et la pollution en SO2 sont liées, comment imagine-t-on le processus aléatoire qui a conduit à nos données ?]

---






count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_user_04_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-reg_versiongraphique-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-reg_versiongraphique-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-reg_versiongraphique-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---
template: model

.pull-left[
## Le modèle de régression simple, graphiquement

&lt;img src="regression_files/figure-html/reg_versiongraphique-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

## Le modèle de régression simple, mathématiquement 
`$$M_{comp}:  \quad \class{alea}{Y_{k}} = \class{rouge}{\beta_0} +\class{rouge}{\beta_1} x_{k}  + \class{alea}{E_{k}},\quad \class{alea}{E_{k}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(x_k\)` la valeur de la variable explicative pour l'observation `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro d'individu, `\(n\)` le nombre total d'individus,
- `\(\class{rouge}{\beta_0}\)` l'ordonnée à l'origine, 
- `\(\class{rouge}{\beta_1}\)` la pente de la droite, mesure de l'effet de la variable `\(x\)`

- `\(\class{rouge}{\sigma^2}\)` la variance.

### Nombre de paramètres du modèle

- `\(2\)` paramètres de moyenne  `\((\class{rouge}{\beta_0}, \class{rouge}{\beta_1})\)`; 
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`

]

---
template: model

##  Une visualisation graphique du modèle d'analyse de régression simple

 .center[Si la population et la pollution en SO2 n'ont aucun lien , comment imagine-t-on le processus aléatoire qui a conduit à nos données ?]


---



count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0_user_04_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-reg_versiongraphique_M0-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-reg_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-reg_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




---
template: model

.pull-left[
## Le modèle sans effet de la variable population, graphiquement

&lt;img src="regression_files/figure-html/reg_versiongraphique_M0-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;
]

.pull-right[

## Le modèle sans effet de la variable population, mathématiquement

`$$M_0: \quad \class{alea}{Y_{k}} = \class{rouge}{\beta_0}  + \class{alea}{E_{k}},\quad \class{ælea}{E_{k}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(k=1,\ldots,n\)` le numéro d'individu, `\(n\)` le nombre total d'individus,
- `\(\class{rouge}{\beta_0}\)` l'ordonnée à l'origine, 

- `\(\class{rouge}{\sigma^2}\)` la variance.

### Nombre de paramètres du modèle

- `\(1\)` paramètre de moyenne  `\(\class{rouge}{\beta_0}\)`; 
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`

]





---
template: model

.center[Lequel de ces mécanismes est le plus crédible au vu des données ?]

&lt;img src="regression_files/figure-html/compare_model_graph-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;
--

Les statistiques permettent de comparer ces deux modèles pour répondre à cette question.


---
template: model

## Le modèle de régression simple sur l'exemple de la pollution.

`$$\class{alea}{Y_k} = \class{rouge}{\beta_0} +\class{rouge}{\beta_1} x_{k}  +\class{alea}{E_{k}},\quad \class{alea}{E_{k}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(x_k\)` la population dans la ville `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro de la ville, `\(n=41\)`,
- `\(\class{rouge}{\beta_0}\)` l'ordonnée à l'origine, 
- `\(\class{rouge}{\beta_1}\)` la pente de la droite, mesure de l'effet de la population sur la pollution.

- `\(\class{rouge}{\sigma^2}\)` la variance.

### Nombre de paramètres du modèle
- 2 paramètres de moyenne
- 1 paramètre de variance


---
template: model

## L'écriture générique du modèle linéaire

`$$\bf{\class{alea}{Y}}=\begin{pmatrix}
\class{alea}{Y_{1}}\\
\class{alea}{Y_{2}}\\
\vdots\\
\class{alea}{Y_{k}}\\
\vdots\\
\class{alea}{Y_{n}}\end{pmatrix} 
 = \begin{pmatrix} 
\class{rouge}{\beta_0} + \class{rouge}{\beta_1}\,x_1\\
\class{rouge}{\beta_0} + \class{rouge}{\beta_1}\,x_2\\
\vdots \\
\class{rouge}{\beta_0} + \class{rouge}{\beta_1}\,x_k\\
 \vdots \\
\class{rouge}{\beta_0} + \class{rouge}{\beta_1}\,x_n\\
 \end{pmatrix}+ \overset{}{\begin{pmatrix}
\class{alea}{E_{1}}\\
\class{alea}{E_{2}}\\
\vdots\\
\class{alea}{E_{k}}\\
\vdots\\
\class{alea}{E_{n}}\\
\end{pmatrix}}$$`

--
`$${\bf{X}} =\overset{\color{gray}{\begin{matrix}{\beta_0}  &amp; {\beta_1}\end{matrix}}}{\begin{pmatrix}
1 &amp; x_1\\
1 &amp; x_2\\
\vdots &amp; \vdots\\
1 &amp; x_k\\
 \vdots &amp; \vdots\\
1 &amp; x_n\\
 \end{pmatrix}},\quad
{\bf{\class{rouge}{\theta}}} =\begin{pmatrix}
\class{rouge}{\beta_0}\\
\class{rouge}{\beta_1}\\
\end{pmatrix}, \quad{\class{alea}{\bf{E}}} = \overset{}{\begin{pmatrix}
\class{alea}{E_{1}}\\
\class{alea}{E_{2}}\\
\vdots\\
\class{alea}{E_{k}}\\
\vdots\\
\class{alea}{E_{n}}\\
\end{pmatrix}}$$`

--
 
 
 `$${ \bf{\class{alea}{Y} = X\class{rouge}{\theta} + \class{alea}{E}}}$$`
 

---
template: model

## Exercice

Les données de pollution
.pull-left[


```
# A tibble: 41 × 3
  City            pop   SO2
  &lt;chr&gt;         &lt;int&gt; &lt;int&gt;
1 Phoenix         582    10
2 Little rock     132    13
3 San Francisco   716    12
4 Denver          515    17
# … with 37 more rows
```


&lt;p class=question&gt; Détailler le modèle sous forme matricielle pour l'exemple de la pollution (écrire les 3 premières lignes de la matrice `\(X\)` )&lt;/p&gt;
]

--

.pull-right[
## Correction 



```
  (Intercept) pop
1           1 582
2           1 132
3           1 716
```

]



---
name: reg_multiple
# Le modèle de régression multiple

--

## Présentation du problème
.pull-left[
Plusieurs variables sont potentiellement liées à la pollution en SO2


- temp : Average temperature in Fahrenheit
- manuf : No. of companies employing more than 20 employees
- pop : Population in thousands
- wind : Average annual wind speed in miles/hour
- precip : annual precipitation height in inches
- days : No. of days of precipitation

]

--

.pull-right[


```
# A tibble: 41 × 8
  City            SO2  temp manuf   pop  wind precip  days
  &lt;chr&gt;         &lt;int&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;
1 Phoenix          10  70.3   213   582   6     7.05    36
2 Little rock      13  61      91   132   8.2  48.5    100
3 San Francisco    12  56.7   453   716   8.7  20.7     67
4 Denver           17  51.9   454   515   9    13.0     86
5 Hartford         56  49.1   412   158   9    43.4    127
# … with 36 more rows
```

]

--
.center[
&lt;a class=question&gt; Quelles sont les variables liées à la pollution en SO2 ? &lt;/a&gt;
]



---
template: reg_multiple

## Le modèle de régression multiple 

`$$\class{alea}{Y_{k}} = \class{rouge}{\beta_0} +\class{rouge}{\beta_1} x_{k,1}  + \class{rouge}{\beta_2} x_{k,2} + \ldots +  \class{rouge}{\beta_p} x_{k,p}  +  \class{alea}{E_{k}},\quad \class{alea}{E_{k}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(x_{k,l}\)` la valeur de la variable explicative `\(l\)` pour l'observation `\(k\)`, 
- `\(k=1,\ldots,n\)` le numéro d'individu, `\(n\)` le nombre total d'individus,
- `\(\class{rouge}{\beta_0}\)` l'ordonnée à l'origine, 
- `\(\class{rouge}{\beta_l}\)` l'effet de la variable `\(x{,l}\)` sur la variable à expliquer,
- `\(\class{rouge}{\sigma^2}\)` la variance.

--

### Nombre de paramètres du modèle

- `\(p+1\)` paramètres de moyenne  `\((\class{rouge}{\beta_0}, \class{rouge}{\beta_1}, \ldots, \class{rouge}{\beta_p})\)`; 
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`

---
template: model
## Sous forme matricielle
`$${ \bf{\class{alea}{Y} = X\class{rouge}{\theta} + \class{alea}{E}}}$$`


`$$\class{alea}{Y}=\begin{pmatrix}
\class{alea}{Y_{1}}\\
\class{alea}{Y_{2}}\\
\vdots\\
\class{alea}{Y_{k}}\\
\vdots\\
\class{alea}{Y_{n}}\end{pmatrix},
 \quad
{\bf{X}} =\overset{\color{gray}{\begin{matrix}{\beta_0}  &amp;&amp; {\beta_1}&amp;&amp; \beta_2&amp;&amp;\ldots &amp;&amp;\beta_p\end{matrix}}}{\begin{pmatrix}
1 &amp; x_{1,1} &amp; x_{1,2} &amp; \ldots &amp;x_{1,p}\\
1 &amp; x_{2,1} &amp; x_{2,2} &amp; \ldots &amp;x_{2,p}\\
\vdots &amp; \vdots&amp; \vdots &amp;&amp; \vdots\\
1 &amp; x_{k,1} &amp; x_{k,2} &amp; \ldots &amp;x_{k,p}\\
 \vdots &amp; \vdots&amp; \vdots &amp;&amp; \vdots\\
1 &amp; x_{n,1} &amp; x_{n,2} &amp; \ldots &amp;x_{n,p}\\
 \end{pmatrix}},\quad
{\bf{\class{rouge}{\theta}}} =\begin{pmatrix}
\class{rouge}{\beta_0}\\
\class{rouge}{\beta_1}\\
\class{rouge}{\class{rouge}{\beta_2}}\\
\vdots\\
\class{rouge}{\beta_p}\\
\end{pmatrix}, \quad{\class{alea}{\bf{E}}} = \overset{}{\begin{pmatrix}
\class{alea}{E_{1}}\\
\class{alea}{E_{2}}\\
\vdots\\
\class{alea}{E_{k}}\\
\vdots\\
\class{alea}{E_{n}}\\
\end{pmatrix}}$$`


--

.care[BREAKING NEWS !!!
]

.center[
.rouge[
Tous les modèles vus en cours depuis le début peuvent s'écrire sous la forme ]

`$${ \bf{\class{alea}{Y} = X\class{rouge}{\theta} + \class{alea}{E}}}$$`

.rouge[
Ce sont tous des modèle slinéaires (d'où la commande `lm` ).
]
]

---
name: parametre
# Estimation des paramètres d'un modèle linéaire


---
template: parametre
## Estimation des paramètres du modèle version matricielle

Le modèle sous forme matricielle s'écrit

`$${ \bf{\class{alea}{Y} = X\class{rouge}{\theta} + \class{alea}{E}}}$$`
avec  `\(\class{rouge}{\theta}\)` .rouge[inconnu]  qu'on cherche à estimer.

--

## Propriété mathématique

`$$\mathbb{E}(\class{alea}{\bf{Y}}) = \bf{X\class{rouge}{\theta}}$$` 
Il s'agit donc de résoudre un système.

--

`$$\bf{X^\intercal}\mathbb{E}(\class{alea}{\bf{Y}}) = \bf{X^\intercal}\bf{X\class{rouge}{\theta}}$$` 
--

Si `\(\bf{X^\intercal}\bf{X}\)` est inversible  alors

`$$\bf{\class{rouge}{\theta}} = (X^\intercal X )^{-1} X^\intercal \mathbb{E}(\class{alea}{Y}) .$$`

--
On remplace `\(\mathbb{E}(\class{alea}{\bf{Y}})\)` par notre meilleure approximation et 
--
.care[ TADAAA !!!!]


---

template: parametre
###  Estimateur de `\(\class{rouge}{\theta}\)` : `\(\class{alea}{T}\)`

`$$\class{alea}{T} = \begin{pmatrix} \class{alea}{B_0} \\ \class{alea}{B_1} \\ \vdots \\ \class{alea}{B_p} \end{pmatrix} = (X^\intercal X )^{-1} X^\intercal \class{alea}{Y}$$`

`\(\class{alea}{B_i}\)` représente un estimateur de `\(\class{rouge}{\beta_i}\)`.

--

### Estimation de `\(\class{rouge}{\theta}\)` : `\(\class{fixe}{\hat{\theta}}\)`


$$\class{fixe}{\hat{\theta}}  = (X^\intercal X )^{-1} X^\intercal \class{fixe}{Y_{obs}} $$


--

### Loi de l'estimateur de `\(\class{rouge}{\theta}\)`


`$$\class{alea}{T}  \sim \mathcal{N}_{p+1}\left(\class{rouge}{\theta}, \class{rouge}{\sigma^2} (X^\intercal X )^{-1}\right).$$`



---
template: parametre
## Le paramètre de variance

L'estimateur de la somme des carrés résiduels s'écrit sous la forme 

`$$RSS = || \class{alea}{Y}- X \, \class{alea}{T} ||^2 = \sum_{k=1}^{n} \left \lbrace \class{alea}{Y_k} - ( \class{alea}{B_0} + \class{alea}{B_1} x_1 + \ldots + \class{alea}{B_p} x_p) \right\rbrace ^2$$`

### Estimateur de la variance 

  $$\class{alea}{S^2} =\frac{\class{alea}{RSS}}{DF_{res}} , $$
est un &lt;a class=care&gt; estimateur sans biais de  `\(\class{rouge}{\sigma^2}\)` &lt;/a&gt; .

Dans le cas du modèle de régression simple  `\(DF_{res}=n-(p+1)\)` (n observations et p+1 paramètres de moyennes à estimer, le nombre de composantes dans le vecteur `\(\class{rouge}{\theta}\)`)

--

### Estimation de `\(\class{rouge}{\sigma^2}\)`

`$$\class{fixe}{\hat{\sigma}}^2 =\frac{1}{n-(p+1)} \class{fixe}{RSS_{obs}},$$`
`$$\class{fixe}{RSS_{obs}} = || \class{fixe}{Y_{obs}}- X \, \class{fixe}{\hat{\theta}}  ||^2 =  \sum_{k=1}^{n} \left \lbrace  \class{fixe}{y_k} - (\class{fixe}{\hat{\beta}_0} + \class{fixe}{\hat{\beta}_1} x_1 + \ldots + \class{fixe}{\hat{\beta}_p} x_p) \right\rbrace ^2$$`



---
template: parametre
## Vérifier l'estimation sur l'exemple de la pollution

.pull-left[

### Estimation manuelle des paramètres de moyenne


```r
Mcomp &lt;- lm(SO2 ~ pop + temp + manuf + wind + precip + days, data = usdata)
X &lt;- model.matrix(Mcomp)
XXprimemoinsUn &lt;- solve(t(X)%*%X)
XXprimemoinsUn %*% t(X) %*% matrix(usdata$SO2, ncol =1)
```

```
                    [,1]
(Intercept) 111.72848064
pop          -0.03927674
temp         -1.26794109
manuf         0.06491817
wind         -3.18136579
precip        0.51235896
days         -0.05205019
```


```r
sqrt( diag( summary(Mcomp)$sigma^2 * XXprimemoinsUn ) )
```

```
(Intercept)         pop        temp       manuf        wind      precip 
47.31810073  0.01513274  0.62117952  0.01574825  1.81501910  0.36275507 
       days 
 0.16201386 
```
] 

--

.pull-right[
### En demandant à R


```r
summary(Mcomp)$coefficients
```

```
                Estimate  Std. Error   t value     Pr(&gt;|t|)
(Intercept) 111.72848064 47.31810073  2.361221 0.0240867374
pop          -0.03927674  0.01513274 -2.595482 0.0138461970
temp         -1.26794109  0.62117952 -2.041183 0.0490557189
manuf         0.06491817  0.01574825  4.122245 0.0002277862
wind         -3.18136579  1.81501910 -1.752800 0.0886503978
precip        0.51235896  0.36275507  1.412410 0.1669175999
days         -0.05205019  0.16201386 -0.321270 0.7499724652
```

]


---
name: modcomp
# Test du modèle complet

--

## Pollution 

&lt;p class="question"&gt; La pollution en SO2 dans les villes américaines est elles liées à l'une au moins des variables caractérisiques des villes ?&lt;/p&gt;


--

On va à la pêche ....

---
template: modcomp
## Sous forme de comparaison de modèle


&lt;img src="regression_files/figure-html/compare_model_graph2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

Sauf que le modèle complet est bien plus complet ....

--
&lt;p class="question"&gt; Le modèle Mcomp est il plus pertinent que le modèle M0 ?&lt;/p&gt;



---
template: modcomp
## Hypothèses du test

On va donc opposer une hypothèse de travail `\(H_0\)` contre une hypothèse alternative `\(H_1\)`. `\(H_0\)` peut donc prendre différentes formes:


`$$\begin{align} 
H_0 &amp; =\left \lbrace \mbox{Auncune variable n'est liée à la pollution en SO2}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{pour tout }1\leq l\leq p, \class{rouge}{\beta_l} =0   \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est équivalent à } M0 \right\rbrace.
\end{align}$$`


`\(H_1\)` prend les formes équivalentes suivantes

`$$\begin{align} 
H_1 &amp; =\left \lbrace \mbox{Au moins 1 variable est liée à la pollution en SO2}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{Il existe un }l,\  1\leq l\leq p, \class{rouge}{\beta_l} \ne 0  \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est préférable à } M0 \right\rbrace.
\end{align}$$`

--

Sous `\(H_0\)`, 

`$$F= \frac{ \frac{\class{alea}{RSS_0 - RSS}}{p} }{\frac{\class{alea}{RSS}}{n-(p+1)}}  \underset{H_0}{\sim}\mathcal{F}(p, n-(p+1))$$`  

---
template: modcomp
## Loi de la statistique de test sous `\(H_0\)` - graphiquement

Sous `\(H_0\)` la loi de distribution de `\(F\)` est 






---

count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="regression_files/figure-html/pvalue_graphique_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-pvalue_graphique-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---
name: test_variable
# Test de l'effet des variables

---
template: test_variable

## Test sur les paramètres

Tester la nullité du paramètre `\(\class{rouge}{\beta_l}\)` revient à tester si la variable `\(x_{.,l}\)` et la variable `\(Y\)` sont liées.


--

Ce test est similaire  au test de comparaison entre le modèle complet et le modèle complet privé de la variable `\(x_{,l}\)`.


`$$\begin{align} 
H_0 &amp; =\left \lbrace \mbox{Dans le modèle complet la variable } l \mbox{ n'a pas d'influence}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{Dans le modèle complet la variable } \class{rouge}{\beta_l=0} \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est équivalent à } M_{-l} \right\rbrace,
\end{align}$$`

avec 
`$$M_{-l}: \class{alea}{Y_k} = \class{rouge}{\beta_0} + \class{rouge}{\beta_1} x_{k,1} + \ldots + \class{rouge}{\beta_{l-1}} x_{k,l-1} + \class{rouge}{\beta_{l+1}} x_{k,l+1} + \ldots + \class{rouge}{\beta_{p}} x_{k,p} + \class{alea}{E_{k}}$$`

---
count: false
template: test_variable

## Equivalence des tests sur l'exemple de la pollution : efft de la population
.pull-left[




```r
summary(Mcomp)$coefficients
```

```
                Estimate  Std. Error   t value     Pr(&gt;|t|)
(Intercept) 111.72848064 47.31810073  2.361221 0.0240867374
pop          -0.03927674  0.01513274 -2.595482 0.0138461970
temp         -1.26794109  0.62117952 -2.041183 0.0490557189
manuf         0.06491817  0.01574825  4.122245 0.0002277862
wind         -3.18136579  1.81501910 -1.752800 0.0886503978
precip        0.51235896  0.36275507  1.412410 0.1669175999
days         -0.05205019  0.16201386 -0.321270 0.7499724652
```
]
--
.pull-right[
### Lien entre les statistiques  de tests


```r
Mcomp_l &lt;- lm(SO2 ~  temp + manuf +  wind + precip + days, data = usdata) 
anova(Mcomp_l, Mcomp)
```

```
Analysis of Variance Table

Model 1: SO2 ~ temp + manuf + wind + precip + days
Model 2: SO2 ~ pop + temp + manuf + wind + precip + days
  Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
1     35 8726.3                              
2     34 7283.3  1    1443.1 6.7365 0.01385 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```
]
---
template: test_variable
## Vigilance sur l'interprétation des tests et des estimations



```
                Estimate  Std. Error   t value     Pr(&gt;|t|)
(Intercept) 111.72848064 47.31810073  2.361221 0.0240867374
pop          -0.03927674  0.01513274 -2.595482 0.0138461970
temp         -1.26794109  0.62117952 -2.041183 0.0490557189
manuf         0.06491817  0.01574825  4.122245 0.0002277862
wind         -3.18136579  1.81501910 -1.752800 0.0886503978
precip        0.51235896  0.36275507  1.412410 0.1669175999
days         -0.05205019  0.16201386 -0.321270 0.7499724652
```

--
&lt;img src="regression_files/figure-html/ggpairs-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---
name: ajust
# Ajustement et choix de modèles






## Un critère pour mesurer l'ajustement du modèle

--

### Le coefficient de détermination `\(R^2\)` pour un modèle

`$$\class{fixe}{R^2(M)}= 1 -\frac{\class{fixe}{RSS_M}}{\class{fixe}{RSS_0}}$$`
représente la proportion de variabilité totale capturée par le modèle.
--

### Les limites de `\(R^2\)` pour la sélection

.pull-left[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Model &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; R2 &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0075 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8639 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8702 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8703 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8767 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8818 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9011 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9011 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]

--

 .pull-right[

 
  &lt;IMG SRC="Ajustement.gif"&gt;
 
 ]

---
template: ajust


### Le coefficient de détermination `\(R^2\)`

`$$\class{fixe}{R^2(M)}= 1 -\frac{\class{fixe}{RSS_M}}{\class{fixe}{RSS_0}}$$`
représente la proportion de variabilité totale capturée par le modèle.

### Le critère Akaike (AIC)

Il utilise la vraisemblance `\(^1\)`  et lui ajoute une pénalité pour compenser le nombre de paramètre et éviter le surajustement.

Il est défini de manière générale pour les modèles statistiques mais dans le cas du modèle linéaire, il est donné par 


$$ AIC(M) = p +  n \class{orange}{\ln{\frac{RSS}{n-(p+1))}}} + n + 3 + n\ln{2\pi} $$

$$ AIC(M) = p +  n \class{orange}{\ln{\hat{\sigma}^2_M}}  \class{clair}{ + n + 3 + n\ln{2\pi}} $$
.care[On va préférer le modèle avec l'AIC le plus petit]

.footnote[1: vraisemblance : une fonction qui mesure justement l'ajustement du modèle aux données]
---

name: ajust
# Ajustement et choix de modèles

## Comparaison AIC et `\(R^2\)`

--
.pull-left[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; Model &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; R2 &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; AIC &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M0 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0000 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 202.1468 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M1 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.0075 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 203.9960 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M2 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8639 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 166.2655 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M3 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8702 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 167.3043 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M4 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8703 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 169.3007 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M5 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8767 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 170.2800 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M6 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.8818 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 171.4397 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M7 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9011 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 169.8802 &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; M8 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.9011 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 171.8784 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]



 .pull-right[

  &lt;IMG SRC="Ajustement.gif"&gt;
 
 ]


Utilisé en TD pour choisir un modèle avec un bon compromis ajustement et parcimonie (petit nombre de paramètres).

---

name: prediction
# Prediction

--

Il est fréquent d'utiliser un modèle de régression pour prédire. 

## Cas de la régression simple

### Prédiction de la valeur moyenne pour un `\(x\)` particulier

* Valeur moyenne .rouge[attendue] pour `\(y\)` pour un `\(x\)` donné : `\(\class{rouge}{\beta_0} + \class{rouge}{\class{rouge}{\beta_1}} x.\)`

* Valeur moyenne .orange[prédite] pour `\(y\)` pour un `\(x\)` donné : `\(\class{fixe}{\hat{\beta}_0} + \class{fixe}{\hat{\beta}_1 x.}\)`


```r
predict(Mpop, newdata=data.frame(pop=333))
```

```
       1 
24.53284 
```

--

### Intervalle de confiance pour la valeur moyenne prédite  pour `\(y\)` pour un `\(x\)` donné : 
`\(\class{alea}{B_0} + \class{alea}{B_1} x \sim\mathcal{N}(\class{rouge}{\beta_0} + \class{rouge}{\beta_1} x, \class{fixe}{\sigma^2} \class{clair}{Constante} )\)`


```r
predict(Mpop, newdata=data.frame(pop=333), interval = 'confidence')
```

```
       fit      lwr      upr
1 24.53284 17.28453 31.78115
```

---
template:  prediction
Il est fréquent d'utiliser un modèle de régression pour prédire. 

## Cas de la régression simple

### Prédiction de la valeur moyenne pour un `\(x\)` particulier et son intervalle de confiance

&lt;img src="regression_files/figure-html/conf_plot-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;



---
template:  prediction
Il est fréquent d'utiliser un modèle de régression pour prédire. 

## Cas de la régression simple

### Prédiction d'une .vert[nouvelle valeur]  `\(\class{vert}{Y_{new}}\)` pour un `\(x\)` donné

*  `\(\mathbb{E}(\class{alea}{Y_{new}}) = \class{rouge}{\beta_0} + \class{rouge}{\beta_1} x_{new}\)`

* La variance de `\(\class{alea}{Y_{new}}\)` prend en compte l'incertitude sur les paramètres et la variabilité naturelle des observations ( `\(\class{rouge}{\sigma^2}\)` )


```r
predict(Mpop, newdata=data.frame(pop=333), interval = 'prediction')
```

```
       fit       lwr      upr
1 24.53284 -17.90225 66.96793
```



---
template:  prediction
Il est fréquent d'utiliser un modèle de régression pour prédire. 

## Cas de la régression simple

### Prédiction d'une .vert[nouvelle valeur] `\(\class{vert}{Y_{new}}\)` pour un `\(x\)` donné

&lt;img src="regression_files/figure-html/predic_plot_pred-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---
template:  prediction
Il est fréquent d'utiliser un modèle de régression pour prédire. 

## Cas de la régression multiple

### Prédiction de la valeur moyenne pour des variables explicatives  `\((x_1, \ldots, x_p)\)` particulières

--

`$$\hat{Y}_k = \class{fixe}{\hat{\beta}_0} +\class{fixe}{\hat{\beta}_1} x_{k,1}+ \ldots + \class{fixe}{\hat{\beta}_p} x_{k,p}$$`



--

### Intervalle de confiance pour la valeur moyenne préditepour des variables explicatives  `\((x_1, \ldots, x_p)\)` particulières :
`$$\class{alea}{B_0}+\class{alea}{B_1} x_1 + \ldots + \class{alea}{B_p} x_p \sim\mathcal{N}( \class{rouge   }{\beta_0} + \class{rouge}{\beta_1} x_1 +\ldots +\class{rouge}{\beta_p} x_p, \class{rouge}{\sigma^2} \class{clair}{Constante} )$$`


--

.bonus[Bonus :] On connaît la loi de n'importe quelle combinaison linéaire des paramères

`$$c \class{alea}{T} \sim\mathcal{N}(c\, \class{rouge}{\theta} , \class{rouge}{\sigma^2} \class{clair}{Constante_c} )$$`



---
# Ce qu'il faut absolument savoir pour les TDs

- savoir reconnaître une situtation de régression multiple
--

  * On cherche à comprendre le lien entre une variable d'intérêt `\(Y\)` et des variables potentiellement explicatives toutes quantitatives.
  
--
- savoir écrire le modèle de régression multiple

--
- Tester l'existence de l'effet d'au moins une des variables explicatives candidates

--
- Tester l'existence de l'effet d'une variable explicative particulière

--
- Pourquoi il faut se méfier du `\(R^2\)`

--
- Ce que signifie prédire en utilisant le modèle et comment le faire







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../courses_tools/resources/collapseoutput.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
