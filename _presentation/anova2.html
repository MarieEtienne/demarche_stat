<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Analyse de la variance à 2 facteurs</title>
    <meta charset="utf-8" />
    <meta name="author" content="Marie-Pierre Etienne" />
    <script src="libs/header-attrs-2.11/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/metropolis.css" rel="stylesheet" />
    <link rel="stylesheet" href="mpe_pres.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Analyse de la variance à 2 facteurs
### Marie-Pierre Etienne
### <a href="mailto:marie-pierre.etienne@agrocampus-ouest.fr" class="email">marie-pierre.etienne@agrocampus-ouest.fr</a>
### 2021/11/19 (updated: 2023-09-08)

---

name: intro

&lt;!-- F1D763 --&gt;
&lt;!-- F7A913 --&gt;
&lt;!-- C94326 --&gt;
&lt;!-- 1F908E --&gt;
&lt;!-- 33658A --&gt;











# Introduction

--

## Etude de la fréquence cardiaque au repos

On a mesuré la fréquence cardiaque de 12 femmes et 12 hommes ayant des activités de loisirs différentes.




```r
freqdata &lt;- read.csv('https://marieetienne.github.io/datasets/activite_FC.csv') %&gt;% select(freqC, Activite, Sexe) %&gt;% 
  mutate(Activite = factor(Activite, levels = c('Natation', 'Pilates', 'Pétanque'))) %&gt;% arrange(Activite, Sexe)
freqdata %&gt;% ggplot() +  aes(x= Sexe, y = freqC)+  geom_boxplot(aes(fill = Sexe, col = Sexe), alpha = 0.5) + theme(legend.position = 'none')  + 
  geom_jitter( size=0.8, alpha=0.7, width = 0.15, aes(col = as.factor(Sexe)))
```

&lt;img src="anova2_files/figure-html/freqdata-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


--
&lt;p class="question"&gt; Les hommes et les femmes ont-ils la même fréquence cardiaque au repos ?&lt;/p&gt;


---
template: intro
## Etude de la fréquence cardiaque au repos

En plus du sexe, il est possible que le type d'activité  influence également la fréquence cardiaque

&lt;img src="anova2_files/figure-html/Activite-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


On souhaite répondre aux questions suivantes:

.pull-left[
* Y a t il un effet du sexe ou de l'activite sur la fréquence cardiaque ? 

* Y a t il un effet du sexe  sur la fréquence cardiaque ? 
]

.pull-right[
* Y a t il un effet del'activite sur la fréquence cardiaque ? 

* L'effet de l'activite sur la fréquence cardiaque est-il le même pour les hommes et les femmes ? 
]
---
template: intro
## Cadre général du modèle d'analyse de la variance à 2 facteurs

On étudie le lien entre  
- une variable quantitative notée `\(Y\)` (la fréquence cardiaque),

Les données peuvent être visualisées à l'aide d'un boxplot.


--
On souhaite répondre aux questions suivantes:

.pull-left[
*  Y a t il un effet de l'un au moins des facteurs ?

* Y a t il un effet du facteur 1 ?]

.pull-right[

* Y a t il un effet du facteur 2 ?

* Y a t il une interaction entre ces deux facteurs ?
]






---
name: model
# Le modèle d'analyse de la variance à 2 facteurs

--
## Graphiquement 

Une visualisation graphique du modèle d'analyse de la variance.

Dans l'hypothèse ou le sexe ou l'activité expliquent une partie de la variabilité de la fréquence cardiaque, comment imagine-t-on le processus aléatoire qui a conduit à nos données ?

--


&lt;img src="anova2_files/figure-html/anova_graph_pcom_1t-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
template: model
# Le modèle d'analyse de la variance à 2 facteurs


## Graphiquement 

Une visualisation graphique du modèle d'analyse de la variance.

Dans l'hypothèse ou le sexe ou l'activité expliquent une partie de la variabilité de la fréquence cardiaque, comment imagine-t-on le processus aléatoire qui a conduit à nos données ?


&lt;img src="anova2_files/figure-html/anova_graph_boxplot-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;



---






count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_anova2_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_anova2_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_anova2_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-anova_versiongraphique_anova2-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-anova_versiongraphique_anova2-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-anova_versiongraphique_anova2-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;



---
count:false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_anova2_fade-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---






count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_M0_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_M0_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/anova_versiongraphique_M0_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-anova_versiongraphique_M0-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-anova_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-anova_versiongraphique_M0-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;






---
template: model

Lequel de ces mécanismes est le plus crédible au vu des donées ?

&lt;img src="anova2_files/figure-html/compare_model_graph-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: model

## Version régulière du modèle Mcomp

`$$\class{alea}{Y_{ijk}} = \class{rouge}{\mu_{ij}} +\class{alea}{E_{ijk}},\quad \class{alea}{E_{ijk}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(i=1,\ldots,I\)` le niveau du facteur 1,
- `\(j=1,\ldots,J\)` le niveau du facteur 2,
- `\(k= 1,\ldots, n_{ij}\)` le numéro de l'individu dans le groupe `\((i,j)\)`, 
- `\(n_{ij}\)` le nombre d'individus dans le groupe `\((i,j)\)` et `\(n=\sum_ j\sum_i n_{ij}\)` le nombre total d'individus,
- `\(\class{rouge}{\mu_{ij}}\)` le comportement moyen du groupe `\((i,j)\)`,
- `\(\class{rouge}{\sigma^2}\)` la variance commune à tous les groupes.


### Nombre de paramètres du modèle

- `\(I*J\)` paramètres de moyenne  `\((\class{rouge}{\mu_{11}, \mu_{12}, \ldots,  \mu_{1J}, \ldots \mu_{IJ}})\)`; 
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`

---
template: model

## Version régulière du modèle Mcomp sur l'exemple 1
`$$\class{alea}{Y_{ijk}} = \class{rouge}{\mu_{ij}} +\class{alea}{E_{ijk}},\quad \class{alea}{E_{ijk}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(i=1,\ldots,3\)` le niveau du facteur Activite,
- `\(j=1,\ldots,2\)` le niveau du facteur Sexe,
- `\(k= 1,\ldots, 4\)` le numéro de l'individu dans le groupe `\((i,j)\)`, 
- `\(4\)` le nombre d'individus dans le groupe `\((i,j)\)` et `\(n= 24=\sum_ j\sum_i n_{ij}\)` le nombre total d'individus,
- `\(\class{rouge}{\mu_{ij}}\)` le comportement moyen du groupe `\((i,j)\)`,
- `\(\class{rouge}{\sigma^2}\)` la variance commune à tous les groupes.



`\(I=3, J= 2\)` 

### Nombre de paramètres
- 6 paramètres de moyenne
- 1 paramètre de variance

---
template: model
## Version singulière (détaillée) du modèle du modèle Mcomp

`$$\class{alea}{Y_{ijk}} = \class{rouge}{\mu} + \class{rouge}{\alpha_i} + \class{rouge}{\beta_j} + \class{rouge}{\gamma_{ij}} +\class{alea}{E_{ijk}},\quad \class{alea}{E_{ijk}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(i=1,\ldots,I\)` le niveau du facteur 1,
- `\(j=1,\ldots,J\)` le niveau du facteur 2,
- `\(k= 1,\ldots, n_{ij}\)` le numéro de l'individu dans le groupe `\((i,j)\)`, 
- `\(\class{rouge}{\mu}\)`  le comportement moyen de référence
- `\(\class{rouge}{\alpha_i}\)`  l'effet différentiel du niveau `\(i\)` 
- `\(\class{rouge}{\beta_j}\)`  l'effet différentiel du niveau `\(j\)` 
- `\(\class{rouge}{\gamma_{ij}}\)`  l'effet différentiel de la rencontre des niveaux `\((i,j),\)` (terme d'interaction)
- `\(\class{rouge}{\sigma^2}\)` la variance commune à tous les groupes.


### Nombre de paramètres du modèle

- `\(1 + I + J + I*J\)` paramètres de moyenne  
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`

--

#### La version dans les logiciels et qui permet de séparer les effets des différens facteurs.




---
template: model
## Lien entre les deux versions du même modèle

 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Groupe&lt;/th&gt;
    &lt;th&gt;V. régulière&lt;/th&gt;
    &lt;th&gt;V. singulière&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt; `\(\mu_{11}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_1 + \beta_1 + \gamma_{11}\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt; `\(\mu_{12}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_1 + \beta_2 + \gamma_{12}\)` &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;I&lt;/td&gt;
    &lt;td&gt; `\(\mu_{IJ}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_I +\beta_J +\gamma_{IJ}\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt; 

--

&lt;a class=care&gt; Problème &lt;/a&gt;  Le problème est identique au modèle d'analyse de la variance, le modèle sous cette forme est  &lt;a style="font-weight:400;"&gt; indéterminé&lt;/a&gt;.

--

#### Solution : ajouter des contraintes
Par défaut dans R :
`\(\alpha_1=0,\)`  `\(\beta_1=0,\)` et `\(\gamma_{1j}=0\)` pour tous les `\(j\)` et `\(\gamma_{i1}=0\)` pour tous les `\(i\)`.

Ce qui correspond à `\(1 + 1 + J + (I-1)=I  + J +1\)` contraintes. 

#### Nombre de paramètres 
- On a donc `\(1 + I + J + IJ\)` paramètres dont `\(I  + J +1\)` sont contraints, il reste donc
`\(IJ\)` à estimer pour le comportement moyen
- 1 paramètre de variance `\(\sigma^2\)`.




---
template: model
## Lien entre les deux versions du même modèle

 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Groupe&lt;/th&gt;
    &lt;th&gt;V. régulière&lt;/th&gt;
    &lt;th&gt;V. contrainte&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;1&lt;/td&gt;
    &lt;td&gt; `\(\mu_{11}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu\)` &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;td&gt;2&lt;/td&gt;
    &lt;td&gt; `\(\mu_{12}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu + \beta_2\)` &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt; &lt;/td&gt;
    &lt;td&gt;  &lt;/td&gt;
    &lt;td&gt;   &lt;/td&gt;
  &lt;/tr&gt;
    &lt;tr&gt;
    &lt;td&gt;I&lt;/td&gt;
    &lt;td&gt; `\(\mu_{IJ}\)` &lt;/td&gt;
    &lt;td&gt; `\(\mu +\alpha_I +\beta_J +\gamma_{IJ}\)` &lt;/td&gt;
  &lt;/tr&gt;
&lt;/table&gt; 



---
template: model
## Que signifient ces contraintes (à partir de l'exemple)

* Quelle est la fréquence moyennes des femmes nageuses ?

--

Les femmes nageuses forment le groupe  `\((1,1)\)` : en moyenne leur fréquence cardiaque est donnée par 
`$$\mu +\alpha_1 +\beta_1 + \gamma_{11} = \mu.$$`

* Quelle est la fréquence moyennes des hommes nageurs ?

--

Les hommes nageurs forment le groupe  `\((1,2)\)` : En moyenne leur fréquence cardiaque dans le modèle est 
`$$\mu + \alpha_1 + \beta_2 +\gamma_{12} = \mu + \beta_2.$$`
`\(\beta_2\)` est donc l'effet différentiel du sexe `\(2\)` (les hommes)   par rapport au sexe de référence `\(1\)` (les femmes)   &lt;a class=care&gt; pour la natation&lt;/a&gt;.

--

* Quelle est la fréquence cardiaque moyenne des femmes pratiquant la pétanque ?

--

Les femmes pratiquant la pétanque  forment le groupe  `\((3,1)\)` : En moyenne leur fréquence cardiaque dans le modèle est 

`$$\mu + \alpha_3 + \beta_1 +\gamma_{31} = \mu + \alpha_3.$$`

`\(\alpha_3\)` est donc l'effet différentiel de l'activité 3 (la pétanque) par rapport à l'activité de référence 1 (la natation) pour le sexe 1 (les femmes).

--

Les valeurs des termes  `\(\gamma_{ij}\)` sont difficiles à interpréter directement, on en reparlera dans les tests.


---
template: model
## Version contrainte du modèle Mcomp

`$$\class{alea}{Y_{ijk}} = \class{rouge}{\mu} + \class{rouge}{\alpha_i} + \class{rouge}{\beta_j} + \class{rouge}{\gamma_{ij}} +\class{alea}{E_{ijk}},\quad \class{alea}{E_{ijk}}\overset{ind}{\sim}\mathcal{N}(0, \class{rouge}{\sigma^2}),$$`
avec 
- `\(i=1,\ldots,I\)` le niveau du facteur 1,
- `\(j=1,\ldots,J\)` le niveau du facteur 2,
- `\(k= 1,\ldots, n_{ij}\)` le numéro de l'individu dans le groupe `\((i,j)\)`, 
- `\(\class{rouge}{\mu}\)`  le comportement moyen de référence
- `\(\class{rouge}{\alpha_i}\)`  l'effet différentiel du niveau `\(i\)`  pour `\(i= \class{rouge}{2},\ldots, I\)`
- `\(\class{rouge}{\beta_j}\)`  l'effet différentiel du niveau `\(j\)` pour `\(j = \class{rouge}{2},\ldots, J\)`,
- `\(\class{rouge}{\gamma_{ij}}\)`  l'effet différentiel de la rencontre des niveaux `\((i,j)\)`, pour `\(\class{rouge}{i\ne1}\)` et `\(\class{rouge}{j\ne1}\)` (terme d'interaction)
- `\(\class{rouge}{\sigma^2}\)` la variance commune à tous les groupes.


### Nombre de paramètres du modèle

- `\(I*J\)` paramètres de moyenne  non contraints
- 1 paramètre de variance `\(\class{rouge}{\sigma^2}\)`


#### La version dans les logiciels et qui permet de séparer les effets des différens facteurs.

---
name: parametre
# Estimation des paramètres
--

###  Estimation des paramètres de moyenne  `\(\class{rouge}{(\hat{\mu}, \hat{\alpha_2},\ldots,\hat{\alpha_I}, \hat{\beta_2}, \ldots, \hat{\beta_J}, \hat{\gamma_22}, \ldots,\hat{\gamma_{IJ}})}\)` 

Par minimisation de la somme des carrés résiduels. 

`$$RSS(\mu,\alpha_i,\beta_j,\gamma_{ij}) =  \sum_{i=1}^{I} \sum_{j=1}^{J} \sum_{k=1}^{n_{ij}} \left \lbrace {y_{ijk}} - (  {\mu} + {\alpha_i} + {\beta_j} + {\gamma_{ij}}) \right\rbrace ^2$$`
--

### Estimation de la variance  `\(\class{rouge}{\sigma^2}\)`

`$$\class{fixe}{\hat{\sigma}}^2 =\frac{1}{n-IJ} \class{fixe}{RSS_{obs}},$$`
`$$\class{fixe}{RSS_{obs}} =  \sum_{i=1}^{I} \sum_{j=1}^{J} \sum_{k=1}^{n_{ij}} \left \lbrace  \class{fixe}{y_k} - (\class{fixe}{\hat{\mu}} + \class{fixe}{\hat{\alpha}_i} + \class{fixe}{\hat{\beta}_j } + \class{fixe}{\hat{\gamma}_{ij}}   ) \right\rbrace ^2$$`



---
name: modcomp
# Test du modèle complet


---
template: modcomp
## Rappel exemple fréquence cardiaque (exemple 1)

On a mesuré la fréquence cardiaque de 12 femmes et 12 hommes pratiquant des activités différentes


&lt;img src="anova2_files/figure-html/freqdata2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


--
&lt;p class="question"&gt; Le sexe ou le type d'activité  sont ils liés à la fréquence cardiaque au repos ?&lt;/p&gt;


---
template: modcomp
## Sous forme de comparaison de modèle


&lt;img src="anova2_files/figure-html/compare_model_graph2-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

--
&lt;p class="question"&gt; Le modèle Mcomp est il plus pertinent que le modèle M0 ?&lt;/p&gt;



---
template: modcomp
## Hypothèses du test

On va donc opposer une hypothèse de travail `\(H_0\)` contre une hypothèse alternative `\(H_1\)`. `\(H_0\)` peut donc prendre différentes formes:


`$$\begin{align} 
H_0 &amp; =\left \lbrace \mbox{Pas de différence entre les différents groupes }\right\rbrace\\
    &amp; =\left \lbrace  \mbox{pour tout }i, \alpha_i =0, \mbox{pour tout }j,\beta_j=0  \mbox{ et pour tout }(i,j),\gamma_{ij}=0   \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est équivalent à } M0 \right\rbrace.
\end{align}$$`

`\(H_1\)` prend les formes équivalentes suivantes

`$$\begin{align} 
H_1 &amp; =\left \lbrace \mbox{Au moins 1 groupe est différent des autres}\right\rbrace\\
    &amp; =\left \lbrace  \mbox{Il existe un }i, \alpha_i  \ne 0  \mbox{ ou un }j, \beta_j \ne 0 \mbox{ ou un } (i,j), \gamma_{ij} \ne 0  \right\rbrace\\
    &amp; =\left \lbrace  M_{comp} \mbox{ est préférable à } M0 \right\rbrace.
\end{align}$$`

--

Sous `\(H_0\)`, 
`$$F= \frac{\frac{SS_{M_{comp}}}{IJ-1}}{\frac{RSS}{n-IJ}} \underset{H_0}{\sim}\mathcal{F}(IJ-1, n-IJ)$$`  

---
template: modcomp
## Loi de la statistique de test sous `\(H_0\)` - graphiquement

Sous `\(H_0\)` la loi de distribution de `\(F\)` est 






---

count: false

&lt;img src="anova2_files/figure-html/pvalue_graphique_user_01_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/pvalue_graphique_user_02_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---
count: false

&lt;img src="anova2_files/figure-html/pvalue_graphique_user_03_output-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

&lt;style&gt;
.panel1-pvalue_graphique-user {
  color: black;
  width: 99%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel2-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 32%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
.panel3-pvalue_graphique-user {
  color: black;
  width: NA%;
  hight: 33%;
  float: left;
  padding-left: 1%;
  font-size: 80%
}
&lt;/style&gt;




---
name: variance_decomposition
# Test des effets de chacun des facteurs : décomposition de SSM

---
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le rectangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`, la partie blanche à `\(RSS_0 -RSS\)`, ce que l'on gagne à utilise rle modèle complet


&lt;br&gt;


&lt;img src="./RSS1.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le rectangle  ci dessous.
- La partie rouge correspond à `\(RSS\)`, la différence en blanc  à `\(RSS_0 -RSS\)`, ce que l'on gagne à utilise rle modèle complet

&lt;br&gt;

&lt;img src="./RSS2.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;

---
count:false
template: variance_decomposition
## Visualisation graphique de la décomposition de la variance

&lt;br&gt;

- `\(RSS_0\)` est schématisée par le rectangle  ci dessous.

- La partie  beige  `\(SSM= RSS_0 -RSS\)`, ce que l'on gagne à utiliser le modèle complet plutôt que `\(M_0\)`. 

On souhaite décomposer cette variabilité


&lt;img src="./RSS3.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## Comment mesurer la variabilité capturée par chaque facteur ?

On veut décomposer la variabilité attribuée au modèle selon les différentes sources.

Considérons les différents modèles possibles

`$$\begin{align}
M_0\ :\ Y_{ijk} &amp;= \mu + E_{ijk}\\
M_{1}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + E_{ijk}\\
M_{2}\ :\ Y_{ijk} &amp;= \mu + \beta_j + E_{ijk}\\
M_{12}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + \beta_j + E_{ijk}\\
M_{comp}\ :\ Y_{ijk} &amp;= \mu + \alpha_i + \beta_j +\gamma_{ij} + E_{ijk}\\
\end{align}$$`


--


* `\(RSS_2 - RSS_{12}\)` mesure ce que l'on gagne à utiliser le modèle `\(M_{12}\)` plutôt que `\(M_2\)`, c'est l'effet du facteur 1 après s'être ajusté au facteur 1

* `\(RSS_1 - RSS_{12}\)` mesure ce que l'on gagne à utiliser le modèle `\(M_{12}\)` plutôt que `\(M_1\)`, c'est l'effet du facteur 2 après s'être ajusté au facteur 2

* `\(RSS_{12} - RSS_{comp}\)` mesure ce que l'on gagne à utiliser le modèle `\(M_{comp}\)` plutôt que `\(M_{12}\)`, c'est l'effet de l'interaction, les effets principaux étant pris en compte.


---
template: variance_decomposition
## Comment mesurer la variabilité capturée par chaque facteur ?

### Réduction de variabilité

`$$\begin{align}
SSM &amp; = RSS_0 - RSS_{comp}\\
SSM &amp; = \underbrace{RSS_0 - RSS_{1}}_{R(\alpha\vert \mu )} + \underbrace{{RSS_1 - RSS_{12}}}_{R(\beta\vert \mu, \alpha )} + \underbrace{RSS_{12} - RSS_{comp}}_{R(\gamma\vert \mu, \alpha,\beta )} \\
SSM &amp; = \underbrace{RSS_0 - RSS_{2}}_{R(\beta\vert \mu )} + \underbrace{{RSS_2 - RSS_{12}}}_{R(\alpha\vert \mu, \beta )} + \underbrace{RSS_{12} - RSS_{comp}}_{R(\gamma\vert \mu, \alpha,\beta )} \\
\end{align}$$`


--

On fait un choix pour les parties confondues

&lt;img src="./RSS5.png" width="55%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition

## Décomposition de type 2

But : Symétriser le rôle des différents facteurs

&lt;img src="./RSS5.png" width="45%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## Test de type 2

 &lt;table style="width:100%"&gt;
  &lt;tr&gt;
    &lt;th&gt;Source&lt;/th&gt;
    &lt;th&gt;H0&lt;/th&gt;
    &lt;th&gt;SS&lt;/th&gt;
    &lt;th&gt;Df&lt;/th&gt;
    &lt;th&gt;F&lt;/th&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
    &lt;th&gt; F1 &lt;/th&gt;
    &lt;th&gt; M2 et M12 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\alpha\vert \beta, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(I-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\alpha\vert\beta, \mu)}{I-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; F2 &lt;/th&gt;
    &lt;th&gt; M1 et M12 sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\beta\vert\alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\(J-1\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\beta\vert \alpha, \mu)}{J-1}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
    &lt;th&gt; Inter &lt;/th&gt;
    &lt;th&gt; M12 et Mcomp sont équivalents &lt;/th&gt;
    &lt;th&gt; `\(R(\gamma\vert \beta, \alpha, \mu)\)` &lt;/th&gt;
    &lt;th&gt; `\((J-1)(J-1)\)` &lt;/th&gt;
    &lt;th&gt; `$$\frac{\frac{R(\gamma\vert \beta, \alpha, \mu)}{(I-1)(J-1)}}{\frac{RSS}{n-IJ}}$$` &lt;/th&gt;
&lt;/tr&gt;
&lt;/table&gt; 

---
template: variance_decomposition
## L'exemple des fréquences cardiaque

Il s'agit du cas particulier `\(n_{ij}\)` sont tous égaux. Le plan d'expérience est dit **équilibré**, pas de variabilité confondue.



&lt;img src="./RSS3_eq.png" width="45%" height="30%" style="display: block; margin: auto;" /&gt;


---
template: variance_decomposition
## L'exemple des fréquences cardiaque

On examine d'abord l'interaction 


```r
library(car)
Mcomp &lt;- lm(freqC ~ Sexe + Activite_Fact + Sexe:Activite_Fact, data = freqdata)
Anova(Mcomp, type = 2)
```

```
Anova Table (Type II tests)

Response: freqC
                   Sum Sq Df F value    Pr(&gt;F)    
Sexe                 7.04  1  2.0199   0.17234    
Activite_Fact      410.58  2 58.8884 1.265e-08 ***
Sexe:Activite_Fact  42.58  2  6.1076   0.00945 ** 
Residuals           62.75 18                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
```

--
 Si l'interaction n'avait pas été significative, on aurait ajuster à nouveau le modèle sans interaction et tester l'effet de chacun des facteurs principaux.

---
name: comp_moyenne
# Comparaison des différents groupes

--

## Moyennes ajustées

C'est la moyenne qu'on observerait dans un plan d'expérience équilibré

`$$\tilde{\mu}_{i.} = \mu + \alpha_i + \frac{1}{J}\sum_{j=1}^J (\beta_j +\gamma_{ij}).$$`
`$$\tilde{\mu}_{.j} = \mu + \beta_j + \frac{1}{I}\sum_{i=1}^I (\alpha_i +\gamma_{ij}).$$`


--

`$$\tilde{\mu}_{1.}-\tilde{\mu}_{2.} =  \alpha_1  -\alpha_{2}+ \frac{1}{J}\sum_{j=1}^J (\gamma_{1j} -\gamma_{2j}).$$`

---
template: comp_moyenne

## Moyennes ajustées pour le sexe


```r
library(emmeans)
m_ajust_sexe &lt;- emmeans(Mcomp, "Sexe")
pairs(m_ajust_sexe)
```

```
 contrast estimate    SE df t.ratio p.value
 F - M       -1.08 0.762 18  -1.421  0.1723

Results are averaged over the levels of: Activite_Fact 
```

```r
plot(m_ajust_sexe)
```

&lt;img src="anova2_files/figure-html/moy_ajustees-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;


---

template: comp_moyenne
## Moyennes ajustées pour l'activité


```r
m_ajust_Activite &lt;- emmeans(Mcomp, "Activite_Fact")
summary(pairs(m_ajust_Activite))
```

```
 contrast            estimate    SE df t.ratio p.value
 Natation - Pilates     -4.75 0.934 18  -5.088  0.0002
 Natation - Pétanque   -10.12 0.934 18 -10.846  &lt;.0001
 Pilates - Pétanque     -5.38 0.934 18  -5.758  0.0001

Results are averaged over the levels of: Sexe 
P value adjustment: tukey method for comparing a family of 3 estimates 
```

---

template: comp_moyenne
## Moyennes ajustées pour l'activité

&lt;img src="anova2_files/figure-html/ajuste_Activite_graph-1.png" width="60%" height="30%" style="display: block; margin: auto;" /&gt;

---

# Ce qu'il faut absolument savoir pour les TDs

- savoir reconnaître une situtation d'analyse de la variance à deux facteurs

--
  * On cherche à comprendre le lien entre une variable d'intérêt `\(Y\)` et deux variables explicatives qualitatives.
  
--

- savoir écrire le modèle d'analyse de la variance à deux facteurs

--
- Tester l'existence de l'effet d'au moins un des facteurs 

--
- Tester l'existence de l'effet d'un facteur en particulier







    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="../courses_tools/resources/collapseoutput.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:10",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
